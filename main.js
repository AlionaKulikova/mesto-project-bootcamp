(()=>{"use strict";var e="",t={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-3",headers:{authorization:"e91d2d7a-7934-4811-b5d2-d42326a1cfb9","Content-Type":"application/json"}};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}const r=e+"e3b9ba5840ebe97bc077.svg",o=e+"35948469632d0421d697.svg";var c=document.querySelector(".picture__images"),u=document.querySelector(".picture__caption"),i=document.querySelector("#picture"),a=document.querySelector(".elements");function s(e){var t=e.target,n=t.getAttribute("src"),r=t.getAttribute("alt");c.setAttribute("src",n),c.setAttribute("alt",r),u.textContent=r}function l(e,c){var u=function(e,c){var u=e,a=c,l=u.name,d=u.link,m=u._id,v=u.likes,h=v.length,b=document.querySelector("#card-template").content.querySelector(".element").cloneNode(!0),y=b.querySelector(".element__image-element"),S=b.querySelector(".like"),_=b.querySelector(".delete");b.querySelector(".element__title").textContent=l,y.setAttribute("src",d),y.setAttribute("alt",l),b.querySelector(".element__likes").textContent=h,v.forEach((function(e){var t=e._id;a===t?S.setAttribute("src",o):S.setAttribute("src",r)})),S.addEventListener("click",(function(e){!function(e,c,u){var i=u,a=e.target;a.setAttribute("disabled",!0);var s=c;if(a.getAttribute("src")===r){var l=function(e){var r=e;return fetch("".concat(t.baseUrl,"/cards/likes/")+r,{method:"PUT",headers:t.headers}).then((function(e){return n(e)}))}(s);l.then((function(e){var t=e,n=t.likes,r=(t.name,n.length);i.querySelector(".element__likes").textContent=r,a.setAttribute("src",o)})).catch((function(e){console.log(e)}))}else{var d=function(e){var r=e;return fetch("".concat(t.baseUrl,"/cards/likes/")+r,{method:"DELETE",headers:t.headers}).then((function(e){return n(e)}))}(s);d.then((function(e){var t=e.likes.length;i.querySelector(".element__likes").textContent=t,a.setAttribute("src",r)})).catch((function(e){console.log(e)}))}}(e,m,b)}));var p=u.owner._id;return a===p?(_.setAttribute("id",m),_.addEventListener("click",(function(e){!function(e){var r=e.target,o=r.getAttribute("id"),c=r.closest(".element");c.setAttribute("disabled",!0);var u=function(e){var r=e;return fetch("".concat(t.baseUrl,"/cards/")+r,{method:"DELETE",headers:t.headers}).then((function(e){return n(e)}))}(o);u.then((function(e){c.remove()})).catch((function(e){console.log(e)}))}(e)}))):_.removeAttribute("src"),b.querySelector(".element__picture").addEventListener("click",(function(e){f(i)})),y.addEventListener("click",s,!0),b}(e,c);a.prepend(u)}function d(e){"Escape"===e.key&&m(document.querySelector(".popup_opened"))}function f(e){e.classList.add("popup_opened"),document.addEventListener("keydown",d)}function m(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",d)}var v=document.querySelector("#profile-edit"),h=document.querySelector(".profile__edit-button"),b=document.querySelector("#editPhoto"),y=document.querySelector(".profile__avatar"),S=document.querySelectorAll(".popup__close"),_=document.querySelector(".form"),p=document.querySelector(".form-new"),q=document.querySelector(".picture__images"),g=document.querySelector(".form-photo"),A=document.querySelector("#new-mesto"),E=document.querySelector("#profileName"),C=document.querySelector("#profileOccupation"),L=document.querySelector("#nameInput"),k=document.querySelector("#jobInput"),x=document.querySelector("#save"),U=document.querySelector(".profile__avatar-img"),T=document.querySelector("#profileAddLink"),w=document.querySelector(".form-photo"),P=document.querySelector("#edit"),B=(document.querySelector("#picture"),document.querySelector("#nameImage")),N=document.querySelector("#addLink"),O=document.querySelector(".add-button"),j=(document.querySelector(".element__title"),document.querySelector("#create"));function D(e){e.setAttribute("disabled",!0),e.classList.add("form__submit-button_color_noactive")}h.addEventListener("click",(function(){return f(v)})),y.addEventListener("click",(function(){return f(b)})),S.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return m(t)})),t.addEventListener("click",(function(e){_.contains(e.target)||p.contains(e.target)||q.contains(e.target)||g.contains(e.target)||m(t)}))})),L.setAttribute("value",E.innerText),k.setAttribute("value",C.innerText),_.addEventListener("submit",(function(e){var r=L.value,o=k.value;x.textContent="Сохранение...";var c=function(e,r){var o=e,c=r;return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:c})}).then((function(e){return n(e)}))}(r,o);c.then((function(e){m(v),E.textContent=r,C.textContent=o,D(x)})).catch((function(e){console.log(e)})).finally((function(){x.textContent="Сохранить"}))})),w.addEventListener("submit",(function(e){var r=T.value;P.textContent="Сохранение...";var o=function(e){var r=e;return console.log(r),fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:r})}).then((function(e){return n(e)}))}(r);o.then((function(e){m(b),U.setAttribute("src",r),D(P),T.value=" "})).catch((function(e){console.log(e)})).finally((function(){P.textContent="Сохранить"}))}));var I,J=fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return n(e)})),H=fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return n(e)}));Promise.all([J,H]).then((function(e){var t=e[0],n=t._id,r=t.avatar,o=t.name,c=t.about;U.setAttribute("src",r),E.textContent=o,C.textContent=c,e[1].forEach((function(e){l(e,n)}))})).catch((function(e){console.log(e)})),O.addEventListener("click",(function(){return f(A)})),p.addEventListener("submit",(function(e){var r=B.value,o=N.value;j.textContent="Создание...";var c=function(e,r){var o=e,c=r;return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o,link:c})}).then((function(e){return n(e)}))}(r,o);c.then((function(e){l(e,e.owner._id),m(A),D(j),B.value="",N.value=""})).catch((function(e){console.log(e)})).finally((function(){j.textContent="Создать"}))})),I={formSelector:".form",inputSelector:".form__field",submitButtonSelector:".form__submit-button",inputErrorClass:"form__field_type_error",errorClass:"form__field-error_active",inactiveButtonClass:"form__submit-button_color_noactive"},Array.from(document.querySelectorAll("".concat(I.formSelector))).forEach((function(e){!function(e,t){e.addEventListener("submit",(function(e){e.preventDefault()}));var n=Array.from(e.querySelectorAll("".concat(t.inputSelector))),r=e.querySelector("".concat(t.submitButtonSelector));n.forEach((function(o){o.addEventListener("input",(function(){(function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("".concat(n.inputErrorClass)),r.classList.remove("".concat(n.errorClass)),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("".concat(r.inputErrorClass)),o.textContent=n,o.classList.add("".concat(r.errorClass))}(e,t,t.validationMessage,n)})(e,o,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("".concat(n.inactiveButtonClass)),t.removeAttribute("disabled")):(t.classList.add("".concat(n.inactiveButtonClass)),t.setAttribute("disabled",!0))}(n,r,t)}))}))}(e,I)}))})();