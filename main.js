(()=>{"use strict";var e="",t=document.querySelector(".picture__images"),n=document.querySelector(".picture__caption");function r(e){var r=e.target,o=r.getAttribute("src"),c=r.getAttribute("alt");t.setAttribute("src",o),n.textContent=c}function o(e){"Escape"===e.key&&u(document.querySelector(".popup_opened"))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)}function u(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)}var i={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-3",headers:{authorization:"e91d2d7a-7934-4811-b5d2-d42326a1cfb9","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}const l=e+"e3b9ba5840ebe97bc077.svg",s=e+"35948469632d0421d697.svg";var d=document.querySelector("#picture"),m=document.querySelector(".elements");function f(e,t){var n=function(e,t){var n=e,o=t,u=n.name,m=n.link,f=n._id,v=n.likes,y=v.length,b=document.querySelector("#card-template").content.querySelector(".element").cloneNode(!0);b.querySelector(".element__title").textContent=u,b.querySelector(".element__image-element").setAttribute("src",m),b.querySelector(".element__image-element").setAttribute("alt",u),b.querySelector(".element__likes").textContent=y,v.forEach((function(e){var t=e._id;o===t?b.querySelector(".like").setAttribute("src",s):b.querySelector(".like").setAttribute("src",l)})),b.querySelector(".like").addEventListener("click",(function(e){!function(e,t,n){var r=n,o=e.target;o.setAttribute("disabled",!0);var c=t;if(o.getAttribute("src")===l){var u=function(e){var t=e;return fetch("".concat(i.baseUrl,"/cards/likes/")+t,{method:"PUT",headers:i.headers}).then((function(e){return a(e)}))}(c);u.then((function(e){var t=e,n=t.likes,c=(t.name,n.length);r.querySelector(".element__likes").textContent=c,o.setAttribute("src",s)})).catch((function(e){console.log(e)}))}else{var d=function(e){var t=e;return fetch("".concat(i.baseUrl,"/cards/likes/")+t,{method:"DELETE",headers:i.headers}).then((function(e){return a(e)}))}(c);d.then((function(e){var t=e.likes.length;r.querySelector(".element__likes").textContent=t,o.setAttribute("src",l)})).catch((function(e){console.log(e)}))}}(e,f,b)}));var _=n.owner._id;return o===_?(b.querySelector(".delete").setAttribute("id",f),b.querySelector(".delete").addEventListener("click",(function(e){!function(e){var t=e.target,n=t.getAttribute("id"),r=t.closest(".element");r.setAttribute("disabled",!0);var o=function(e){var t=e;return fetch("".concat(i.baseUrl,"/cards/")+t,{method:"DELETE",headers:i.headers}).then((function(e){return a(e)}))}(n);o.then((function(e){r.remove()})).catch((function(e){console.log(e)}))}(e)}))):b.querySelector(".delete").removeAttribute("src"),b.querySelector(".element__picture").addEventListener("click",(function(e){c(d)})),b.querySelectorAll(".element__image-element").forEach((function(e){e.addEventListener("click",r,!0)})),b}(e,t);m.prepend(n)}var v=document.querySelector(".form"),y=v.querySelector(".form__field"),b=(v.querySelector(".".concat(y.id,"-error")),function(e,t,n){t.validity.valid?function(e,t,n){e.addEventListener("submit",(function(e){e.preventDefault()}));var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("".concat(n.inputErrorClass)),r.classList.remove("".concat(n.errorClass)),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("".concat(r.inputErrorClass)),o.textContent=n,o.classList.add("".concat(r.errorClass))}(e,t,t.validationMessage,n)}),_=document.querySelector("#profile-edit"),h=document.querySelector(".profile__edit-button"),S=document.querySelector("#editPhoto"),q=document.querySelector(".profile__avatar"),p=document.querySelectorAll(".popup__close"),g=document.querySelector(".form"),A=document.querySelector(".form-new"),E=document.querySelector(".picture__images"),L=document.querySelector(".form-photo"),k=document.querySelector("#new-mesto"),C=document.querySelector("#profileName"),x=document.querySelector("#profileOccupation"),U=document.querySelector("#nameInput"),T=document.querySelector("#jobInput"),B=document.querySelector("#save"),I=document.querySelector(".profile__avatar-img"),w=(document.querySelector("#profileAddLink"),document.querySelector(".form-photo")),P=document.querySelector("#edit"),N=(document.querySelector("#picture"),document.querySelector("#nameImage"),document.querySelector("#addLink"),document.querySelector(".add-button")),O=(document.querySelector(".element__title"),document.querySelector(".element__image-element"),document.querySelector("#create"));h.addEventListener("click",(function(){return c(_)})),q.addEventListener("click",(function(){return c(S)})),p.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return u(t)})),t.addEventListener("click",(function(e){g.contains(e.target)||A.contains(e.target)||E.contains(e.target)||L.contains(e.target)||u(t)}))})),U.setAttribute("value",C.innerText),T.setAttribute("value",x.innerText),g.addEventListener("submit",(function(e){var t=U.value,n=T.value;B.textContent="Сохранение...";var r=function(e,t){var n=e,r=t;return fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return a(e)}))}(t,n);r.then((function(e){u(_),C.textContent=t,x.textContent=n,B.setAttribute("disabled",!0),B.classList.add("form__submit-button_color_noactive")})).catch((function(e){console.log(e)})).finally((function(){B.textContent="Сохранить"}))})),w.addEventListener("submit",(function(e){var t=document.getElementById("profileAddLink").value;P.textContent="Сохранение...";var n=function(e){var t=e;return console.log(t),fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then((function(e){return a(e)}))}(t);n.then((function(e){u(S),I.setAttribute("src",t),P.setAttribute("disabled",!0),P.classList.add("form__submit-button_color_noactive"),document.querySelector("#profileAddLink").value=" "})).catch((function(e){console.log(e)})).finally((function(){P.textContent="Сохранить"}))}));var j,D=fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then((function(e){return a(e)})),J=fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then((function(e){return a(e)}));Promise.all([D,J]).then((function(e){var t=e[0],n=t._id,r=t.avatar,o=t.name,c=t.about;I.setAttribute("src",r),C.textContent=o,x.textContent=c,e[1].forEach((function(e){f(e,n)}))})).catch((function(e){console.log(e)})),N.addEventListener("click",(function(){return c(k)})),A.addEventListener("submit",(function(e){var t=document.getElementById("nameImage").value,n=document.getElementById("addLink").value;O.textContent="Создание...";var r=function(e,t){var n=e,r=t;return fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return a(e)}))}(t,n);r.then((function(e){f(e,e.owner._id),u(k),O.setAttribute("disabled",!0),O.classList.add("form__submit-button_color_noactive"),document.querySelector("#nameImage").value="",document.querySelector("#addLink").value=""})).catch((function(e){console.log(e)})).finally((function(){O.textContent="Создать"}))})),j={formSelector:".form",inputSelector:".form__field",submitButtonSelector:".form__submit-button",inputErrorClass:"form__field_type_error",errorClass:"form__field-error_active",inactiveButtonClass:"form__submit-button_color_noactive"},Array.from(document.querySelectorAll("".concat(j.formSelector))).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll("".concat(t.inputSelector))),r=e.querySelector("".concat(t.submitButtonSelector));n.forEach((function(o){o.addEventListener("input",(function(){b(e,o,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("".concat(n.inactiveButtonClass)),t.removeAttribute("disabled")):(t.classList.add("".concat(n.inactiveButtonClass)),t.setAttribute("disabled",!0))}(n,r,t)}))}))}(e,j)}))})();