(()=>{"use strict";var e="",t=document.querySelector(".picture__images"),r=document.querySelector(".picture__caption");function n(e){var n=e.target,o=n.getAttribute("src"),c=n.getAttribute("alt");t.setAttribute("src",o),r.textContent=c}function o(e){"Escape"===e.key&&u(document.querySelector(".popup_opened"))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)}function u(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)}var i={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-3",headers:{authorization:"e91d2d7a-7934-4811-b5d2-d42326a1cfb9","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}const l=e+"e3b9ba5840ebe97bc077.svg",d=e+"35948469632d0421d697.svg";var s=document.querySelector("#picture"),m=document.querySelector(".elements");function f(e,t){var r=function(e,t){var r=e,o=t,u=r.name,m=r.link,f=r._id,v=r.likes,_=v.length,y=document.querySelector("#card-template").content.querySelector(".element").cloneNode(!0);y.querySelector(".element__title").textContent=u,y.querySelector(".element__image-element").setAttribute("src",m),y.querySelector(".element__image-element").setAttribute("alt",u),y.querySelector(".element__likes").textContent=_,v.forEach((function(e){var t=e._id;o===t?y.querySelector(".like").setAttribute("src",d):y.querySelector(".like").setAttribute("src",l)})),y.querySelector(".like").addEventListener("click",(function(e){!function(e,t,r){var n=r,o=e.target;o.setAttribute("disabled",!0);var c=t;if(o.getAttribute("src")===l){var u=function(e){var t=e;return fetch("".concat(i.baseUrl,"/cards/likes/")+t,{method:"PUT",headers:i.headers}).then((function(e){return a(e)}))}(c);u.then((function(e){var t=e,r=t.likes,c=(t.name,r.length);n.querySelector(".element__likes").textContent=c,o.setAttribute("src",d)})).catch((function(e){console.log(e)}))}else{var s=function(e){var t=e;return fetch("".concat(i.baseUrl,"/cards/likes/")+t,{method:"DELETE",headers:i.headers}).then((function(e){return a(e)}))}(c);s.then((function(e){var t=e.likes.length;n.querySelector(".element__likes").textContent=t,o.setAttribute("src",l)})).catch((function(e){console.log(e)}))}}(e,f,y)}));var b=r.owner._id;return o===b?(y.querySelector(".delete").setAttribute("id",f),y.querySelector(".delete").addEventListener("click",(function(e){!function(e){var t=e.target,r=t.getAttribute("id"),n=t.closest(".element");n.setAttribute("disabled",!0);var o=function(e){var t=e;return fetch("".concat(i.baseUrl,"/cards/")+t,{method:"DELETE",headers:i.headers}).then((function(e){return a(e)}))}(r);o.then((function(e){n.remove()})).catch((function(e){console.log(e)}))}(e)}))):y.querySelector(".delete").removeAttribute("src"),y.querySelector(".element__picture").addEventListener("click",(function(e){c(s)})),y.querySelectorAll(".element__image-element").forEach((function(e){e.addEventListener("click",n,!0)})),y}(e,t);m.prepend(r)}var v=document.querySelector("#profile-edit"),_=document.querySelector(".profile__edit-button"),y=document.querySelector("#editPhoto"),b=document.querySelector(".profile__avatar"),h=document.querySelectorAll(".popup__close"),S=document.querySelector(".form"),q=document.querySelector(".form-new"),p=document.querySelector(".picture__images"),g=document.querySelector(".form-photo"),L=document.querySelector("#new-mesto"),k=document.querySelector("#profileName"),E=document.querySelector("#profileOccupation"),A=document.querySelector("#nameInput"),x=document.querySelector("#jobInput"),C=document.querySelector("#save"),I=document.querySelector(".profile__avatar-img"),T=(document.querySelector("#profileAddLink"),document.querySelector(".form-photo")),w=document.querySelector("#edit"),P=(document.querySelector("#picture"),document.querySelector("#nameImage"),document.querySelector("#addLink"),document.querySelector(".add-button")),U=(document.querySelector(".element__title"),document.querySelector(".element__image-element"),document.querySelector("#create"));_.addEventListener("click",(function(){return c(v)})),b.addEventListener("click",(function(){return c(y)})),h.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return u(t)})),t.addEventListener("click",(function(e){S.contains(e.target)||q.contains(e.target)||p.contains(e.target)||g.contains(e.target)||u(t)}))})),A.setAttribute("value",k.innerText),x.setAttribute("value",E.innerText),S.addEventListener("submit",(function(e){var t=A.value,r=x.value;C.textContent="Сохранение...";var n=function(e,t){var r=e,n=t;return fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:r,about:n})}).then((function(e){return a(e)}))}(t,r);n.then((function(e){u(v),k.textContent=t,E.textContent=r,C.setAttribute("disabled",!0),C.classList.add("form__submit-button_color_noactive")})).catch((function(e){console.log(e)})).finally((function(){C.textContent="Сохранить"}))})),T.addEventListener("submit",(function(e){var t=document.getElementById("profileAddLink").value;w.textContent="Сохранение...";var r=function(e){var t=e;return console.log(t),fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then((function(e){return a(e)}))}(t);r.then((function(e){u(y),I.setAttribute("src",t),w.setAttribute("disabled",!0),w.classList.add("form__submit-button_color_noactive"),document.querySelector("#profileAddLink").value=" "})).catch((function(e){console.log(e)})).finally((function(){w.textContent="Сохранить"}))}));var j=fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then((function(e){return a(e)})),D=fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then((function(e){return a(e)}));Promise.all([j,D]).then((function(e){var t=e[0],r=t._id,n=t.avatar,o=t.name,c=t.about;I.setAttribute("src",n),k.textContent=o,E.textContent=c,e[1].forEach((function(e){f(e,r)}))})).catch((function(e){console.log(e)})),P.addEventListener("click",(function(){return c(L)})),q.addEventListener("submit",(function(e){var t=document.getElementById("nameImage").value,r=document.getElementById("addLink").value;U.textContent="Создание...";var n=function(e,t){var r=e,n=t;return fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:r,link:n})}).then((function(e){return a(e)}))}(t,r);n.then((function(e){f(e,e.owner._id),u(L),U.setAttribute("disabled",!0),U.classList.add("form__submit-button_color_noactive"),document.querySelector("#nameImage").value="",document.querySelector("#addLink").value=""})).catch((function(e){console.log(e)})).finally((function(){U.textContent="Создать"}))})),function(e,t){var r={name:"#nameInputGroup",job:"#nameInputGroupSecond"};function n(t,n){var o=r[t],c=e.querySelector(o);c.querySelector(".form__field").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=n,u.classList.remove("form__error_hidden")}function o(e,r,n){return(0,t[e])(r,n)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),a=Object.fromEntries(i),l=o(c,u,a);l?n(c,l):function(t){var n=r[t],o=e.querySelector(n);o.querySelector(".form__field").classList.remove("form__input_invalid");var c=o.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var d=!0;if(i.forEach((function(e,t){var r=o(t,e,a);r&&(n(t,r),d=!1)})),!d){var s=document.querySelector("#save");return s.setAttribute("disabled",!0),void s.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#save");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(document.querySelector("#form"),{name:function(e,t){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>40?"Максимальное количество символов:40":null:"Вы пропустили это поле"},job:function(e,t){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>200?"Максимальное количество символов:40":null:"Вы пропустили это поле"}}),function(e,t){var r={nameImage:"#nameCard",addLink:"#linkCard"};function n(t,n){var o=r[t],c=e.querySelector(o);c.querySelector(".form__field_name_text").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=n,u.classList.remove("form__error_hidden")}function o(e,r,n){return(0,t[e])(r,n)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),a=Object.fromEntries(i),l=o(c,u,a);l||l?n(c,l):function(t){var n=r[t],o=e.querySelector(n);o.querySelector(".form__field_name_text").classList.remove("form__input_invalid");var c=o.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var d=!0;if(i.forEach((function(e,t){var r=o(t,e,a);r&&(n(t,r),d=!1)})),!d){var s=document.querySelector("#create");return s.setAttribute("disabled",!0),void s.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#create");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(document.querySelector("#form-new"),{nameImage:function(e){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>30?"Максимальное количество символов:40":null:"Вы пропустили это поле"},addLink:function(e){if(!e)return"Вы пропустили это поле";var t=document.createElement("input");return t.type="url",t.required=!0,t.value=e,("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e))?null:"Введите адрес сайта"}}),function(e,t){var r={addLinkPhoto:"#linkCardPhoto"};function n(t,n){var o=r[t],c=e.querySelector(o);c.querySelector(".form__field_name_text").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=n,u.classList.remove("form__error_hidden")}function o(e,r,n){return(0,t[e])(r,n)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),a=Object.fromEntries(i),l=o(c,u,a);l||l?n(c,l):function(t){var n=r[t],o=e.querySelector(n);o.querySelector(".form__field_name_text").classList.remove("form__input_invalid");var c=o.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var d=!0;if(i.forEach((function(e,t){var r=o(t,e,a);r&&(n(t,r),d=!1)})),!d){var s=document.querySelector("#edit");return s.setAttribute("disabled",!0),void s.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#edit");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(document.querySelector("#form-photo"),{addLinkPhoto:function(e){if(!e)return"Вы пропустили это поле";var t=document.createElement("input");return t.type="url",t.required=!0,t.value=e,("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e))?null:"Введите адрес сайта"}})})();