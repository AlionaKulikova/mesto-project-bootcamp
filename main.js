(()=>{"use strict";var e="",t=document.querySelector(".picture__images"),r=document.querySelector(".picture__caption");function n(e){var n=e.target,o=n.getAttribute("src"),c=n.getAttribute("alt");t.setAttribute("src",o),r.textContent=c}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",(function(t){"Escape"===t.key&&o(e)}))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",(function(t){"Escape"===t.key&&o(e)}))}var u={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-3",headers:{authorization:"e91d2d7a-7934-4811-b5d2-d42326a1cfb9","Content-Type":"application/json"}};function i(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}const a=e+"e3b9ba5840ebe97bc077.svg",l=e+"35948469632d0421d697.svg";function d(e,t){var r=document.querySelector(".elements"),o=function(e,t){var r=e,o=t,d=r.name,s=r.link,m=r._id,f=r.likes,_=f.length,v=document.querySelector("#card-template").content.querySelector(".element").cloneNode(!0);v.querySelector(".element__title").textContent=d,v.querySelector(".element__image-element").setAttribute("src",s),v.querySelector(".element__image-element").setAttribute("alt",d),v.querySelector(".element__likes").textContent=_,f.forEach((function(e){var t=e._id;o===t?v.querySelector(".like").setAttribute("src",l):v.querySelector(".like").setAttribute("src",a)})),v.querySelector(".like").addEventListener("click",(function(e){!function(e,t,r){var n=r,o=e.target;o.setAttribute("disabled",!0);var c=t;if(o.getAttribute("src")===a){var d=function(e){var t=e;return fetch("".concat(u.baseUrl,"/cards/likes/")+t,{method:"PUT",headers:u.headers}).then((function(e){return i(e)}))}(c);d.then((function(e){var t=e,r=t.likes,c=(t.name,r.length);n.querySelector(".element__likes").textContent=c,o.setAttribute("src",l)})).catch((function(e){console.log(e)}))}else{var s=function(e){var t=e;return fetch("".concat(u.baseUrl,"/cards/likes/")+t,{method:"DELETE",headers:u.headers}).then((function(e){return i(e)}))}(c);s.then((function(e){var t=e.likes.length;n.querySelector(".element__likes").textContent=t,o.setAttribute("src",a)})).catch((function(e){console.log(e)}))}}(e,m,v)}));var y=r.owner._id;return o===y?(v.querySelector(".delete").setAttribute("id",m),v.querySelector(".delete").addEventListener("click",(function(e){!function(e){var t=e.target,r=t.getAttribute("id"),n=t.closest(".element");n.setAttribute("disabled",!0);var o=function(e){var t=e;return fetch("".concat(u.baseUrl,"/cards/")+t,{method:"DELETE",headers:u.headers}).then((function(e){return i(e)}))}(r);o.then((function(e){n.remove()})).catch((function(e){console.log(e)}))}(e)}))):v.querySelector(".delete").removeAttribute("src"),v.querySelector(".element__picture").addEventListener("click",(function(e){c(document.querySelector("#picture"))})),v.querySelectorAll(".element__image-element").forEach((function(e){e.addEventListener("click",n,!0)})),v}(e,t);r.prepend(o)}var s=document.querySelector("#profile-edit"),m=document.querySelector(".profile__edit-button"),f=document.querySelector("#editPhoto"),_=document.querySelector(".profile__avatar"),v=document.querySelectorAll(".popup__close"),y=document.querySelector(".form"),b=document.querySelector(".form-new"),h=document.querySelector(".picture__images"),S=document.querySelector(".form-photo"),q=document.querySelector("#new-mesto"),p=document.querySelector("#profileName"),g=document.querySelector("#profileOccupation"),L=document.querySelector("#nameInput"),k=document.querySelector("#jobInput"),E=document.querySelector("#save"),A=document.querySelector(".profile__avatar-img"),x=(document.querySelector("#profileAddLink"),document.querySelector(".form-photo")),C=document.querySelector("#edit"),I=(document.querySelector("#picture"),document.querySelector("#nameImage"),document.querySelector("#addLink"),document.querySelector(".add-button")),T=(document.querySelector(".element__title"),document.querySelector(".element__image-element"),document.querySelector("#create"));m.addEventListener("click",(function(){return c(s)})),_.addEventListener("click",(function(){return c(f)})),v.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return o(t)})),t.addEventListener("click",(function(e){y.contains(e.target)||b.contains(e.target)||h.contains(e.target)||S.contains(e.target)||o(t)}))})),L.setAttribute("value",p.innerText),k.setAttribute("value",g.innerText),y.addEventListener("click",(function(e){if(e.target.classList.contains("form__submit-button")){var t=document.getElementById("nameInput").value,r=document.getElementById("jobInput").value;p.textContent=t,g.textContent=r,E.textContent="Сохранение...";var n=function(e,t){var r=e,n=t;return fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:r,about:n})}).then((function(e){return i(e)}))}(t,r);n.then((function(e){o(s),E.setAttribute("disabled",!0),E.classList.add("form__submit-button_color_noactive"),E.textContent="Сохранить"})).catch((function(e){console.log(e)}))}})),x.addEventListener("click",(function(e){if(e.target.classList.contains("form__submit-button")){var t=document.getElementById("profileAddLink").value;A.setAttribute("src",t),C.textContent="Сохранение...";var r=function(e){var t=e;return console.log(t),fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:t})}).then((function(e){return i(e)}))}(t);r.then((function(e){o(f),C.setAttribute("disabled",!0),C.classList.add("form__submit-button_color_noactive"),C.textContent="Сохранить"})).catch((function(e){console.log(e)})),document.querySelector("#profileAddLink").value=" "}}));var w=fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then((function(e){return i(e)})),j=fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then((function(e){return i(e)}));Promise.all([w,j]).then((function(e){var t=e[0],r=t._id,n=t.avatar,o=t.name,c=t.about;A.setAttribute("src",n),p.textContent=o,g.textContent=c,e[1].forEach((function(e){d(e,r)}))})).catch((function(e){console.log(e)})),I.addEventListener("click",(function(){return c(q)})),b.addEventListener("click",(function(e){if(e.target.classList.contains("form__submit-button")){var t=document.getElementById("nameImage").value,r=document.getElementById("addLink").value;T.textContent="Создание...";var n=function(e,t){var r=e,n=t;return fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:r,link:n})}).then((function(e){return i(e)}))}(t,r);n.then((function(e){d(e,e.owner._id),o(q),T.setAttribute("disabled",!0),T.classList.add("form__submit-button_color_noactive"),document.querySelector("#nameImage").value="",document.querySelector("#addLink").value="",T.textContent="Создать"})).catch((function(e){console.log(e)}))}})),function(e,t){var r={name:"#nameInputGroup",job:"#nameInputGroupSecond"};function n(t,n){var o=r[t],c=e.querySelector(o);c.querySelector(".form__field").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=n,u.classList.remove("form__error_hidden")}function o(e,r,n){return(0,t[e])(r,n)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),a=Object.fromEntries(i),l=o(c,u,a);l?n(c,l):function(t){var n=r[t],o=e.querySelector(n);o.querySelector(".form__field").classList.remove("form__input_invalid");var c=o.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var d=!0;if(i.forEach((function(e,t){var r=o(t,e,a);r&&(n(t,r),d=!1)})),!d){var s=document.querySelector("#save");return s.setAttribute("disabled",!0),void s.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#save");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(document.querySelector("#form"),{name:function(e,t){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>40?"Максимальное количество символов:40":null:"Вы пропустили это поле"},job:function(e,t){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>200?"Максимальное количество символов:40":null:"Вы пропустили это поле"}}),function(e,t){var r={nameImage:"#nameCard",addLink:"#linkCard"};function n(t,n){var o=r[t],c=e.querySelector(o);c.querySelector(".form__field_name_text").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=n,u.classList.remove("form__error_hidden")}function o(e,r,n){return(0,t[e])(r,n)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),a=Object.fromEntries(i),l=o(c,u,a);l||l?n(c,l):function(t){var n=r[t],o=e.querySelector(n);o.querySelector(".form__field_name_text").classList.remove("form__input_invalid");var c=o.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var d=!0;if(i.forEach((function(e,t){var r=o(t,e,a);r&&(n(t,r),d=!1)})),!d){var s=document.querySelector("#create");return s.setAttribute("disabled",!0),void s.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#create");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(document.querySelector("#form-new"),{nameImage:function(e){return e?e.length<2?"Минимальное количество символов:2. Длина текста сейчас: 1 символ":e.length>30?"Максимальное количество символов:40":null:"Вы пропустили это поле"},addLink:function(e){if(!e)return"Вы пропустили это поле";var t=document.createElement("input");return t.type="url",t.required=!0,t.value=e,("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e))?null:"Введите адрес сайта"}}),function(e,t){var r={addLinkPhoto:"#linkCardPhoto"};function n(t,n){var o=r[t],c=e.querySelector(o);c.querySelector(".form__field_name_text").classList.add("form__input_invalid");var u=c.querySelector(".form__error");u.textContent=n,u.classList.remove("form__error_hidden")}function o(e,r,n){return(0,t[e])(r,n)}e.addEventListener("input",(function(t){var c=t.target.name,u=t.target.value,i=new FormData(t.currentTarget),a=Object.fromEntries(i),l=o(c,u,a);l||l?n(c,l):function(t){var n=r[t],o=e.querySelector(n);o.querySelector(".form__field_name_text").classList.remove("form__input_invalid");var c=o.querySelector(".form__error");c.textContent=null,c.classList.add("form__error_hidden")}(c);var d=!0;if(i.forEach((function(e,t){var r=o(t,e,a);r&&(n(t,r),d=!1)})),!d){var s=document.querySelector("#edit");return s.setAttribute("disabled",!0),void s.classList.add("form__submit-button_color_noactive")}var m=document.querySelector("#edit");m.removeAttribute("disabled"),m.classList.remove("form__submit-button_color_noactive")})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(document.querySelector("#form-photo"),{addLinkPhoto:function(e){if(!e)return"Вы пропустили это поле";var t=document.createElement("input");return t.type="url",t.required=!0,t.value=e,("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e))?null:"Введите адрес сайта"}})})();